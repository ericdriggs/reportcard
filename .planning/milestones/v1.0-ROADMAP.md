# Milestone v1.0: Browse JSON API

**Status:** SHIPPED 2026-02-05
**Phases:** 1-4
**Total Plans:** 8

## Overview

This roadmap delivered production-ready JSON API endpoints by validating existing infrastructure, implementing /run/latest resolution, completing feature parity, and safely exposing endpoints. The phases followed dependency order: foundation safety measures before implementation, core features before final exposure.

## Phases

### Phase 1: Foundation & Validation

**Goal:** Validate existing JSON endpoints work correctly
**Depends on:** None (foundation phase)
**Plans:** 3 plans

Plans:
- [x] 01-01-PLAN.md — Test hierarchy endpoints (company -> org -> repo -> branch)
- [x] 01-02-PLAN.md — Test job/run/stage endpoints
- [x] 01-03-PLAN.md — Test SHA lookups and error cases

**Requirements:**
- API-02: All existing JSON endpoints return valid JSON (verified by tests)
- TEST-01: Tests for each browse JSON endpoint using Testcontainers MySQL
- TEST-02: Tests validate actual JSON serialization output

**Success Criteria:**
1. User can call any existing `/v1/api/browse/*` endpoint and receive valid JSON response
2. User can verify path routing works correctly without conflicts
3. User can examine integration test suite showing coverage for each JSON endpoint
4. User can observe consistent error responses across all JSON endpoints
5. User can confirm JOOQ POJOs serialize without circular reference failures

---

### Phase 2: Latest Endpoints

**Goal:** Enable latest run resolution for jobs and stages
**Depends on:** Phase 1 (validation patterns established)
**Plans:** 3 plans

Plans:
- [x] 02-01-PLAN.md — Add getLatestRunId service method (Wave 1)
- [x] 02-02-PLAN.md — Add latest run endpoint (Wave 2)
- [x] 02-03-PLAN.md — Add latest stage endpoint (Wave 2)

**Requirements:**
- LATEST-01: Add `/job/{jobId}/run/latest` endpoint — returns latest run for job
- LATEST-02: Add `/job/{jobId}/run/latest/stage/{stage}` endpoint — returns latest run's specific stage test results

**Success Criteria:**
1. User can call `/job/{jobId}/run/latest` and receive the most recent run
2. User can call `/job/{jobId}/run/latest/stage/{stage}` and receive test results for specific stage
3. User can observe that latest endpoints return identical JSON structure to ID-based endpoints
4. User can verify latest resolution uses max(run_id) query

---

### Phase 3: Query Parameter Parity

**Goal:** Complete feature parity with HTML browse endpoints
**Depends on:** Phase 2 (all endpoints exist)
**Plans:** 1 plan

Plans:
- [x] 03-01-PLAN.md — Add ?runs=N parameter to getBranchJobsRuns and getJobRunsStages endpoints

**Requirements:**
- FILTER-01: ?runs=N parameter works on JSON run endpoints (parity with HTML browse)

**Success Criteria:**
1. User can call JSON endpoints with `?runs=N` parameter and receive filtered results
2. User can verify query parameter validation matches BrowseUIController behavior
3. User can observe consistent parameter handling across both HTML and JSON endpoints

---

### Phase 4: API Exposure

**Goal:** Safely expose JSON API to production clients
**Depends on:** Phase 3 (all features complete and tested)
**Plans:** 1 plan

Plans:
- [x] 04-01-PLAN.md — Remove @Hidden annotation and verify API exposure

**Requirements:**
- API-01: Remove @Hidden annotation from BrowseJsonController to expose /v1/api/* endpoints

**Success Criteria:**
1. User can view all JSON endpoints in Swagger UI documentation
2. User can access /v1/api/* endpoints without @Hidden restriction
3. User can verify no path routing conflicts exist between HTML and JSON controllers
4. User can observe OpenAPI documentation with operation summaries

---

## Milestone Summary

**Decimal Phases:** None (clean execution)

**Key Decisions:**
- 4-phase roadmap structure: Natural boundaries from foundation → core feature → parity → exposure
- Latest resolution via max(run_id): Follows auto-incrementing run_id pattern in existing schema
- Post-filter cache for runs parameter: Avoid cache explosion from N run values
- Delegate latest endpoints to ID-based endpoints: Ensures identical response shapes
- Remove @Hidden without adding @Operation: Minimal change scope

**Issues Resolved:**
- Java 17 requirement for Testcontainers tests
- Corrupted gradlew file fixed via git checkout
- getBranch/getRunFromReference error handling documented for future improvement

**Issues Deferred:**
- Cache TTL strategy for latest endpoints (research suggests shorter TTL)
- Database index verification for job_id
- OpenAPI documentation enhancement (@Operation annotations)
- Fix getBranch/getRunFromReference error handling

**Technical Debt Incurred:**
- No @Operation annotations on BrowseJsonController endpoints (auto-generated docs only)

---

_For current project status, see .planning/PROJECT.md_
_Archived: 2026-02-05 as part of v1.0 milestone completion_
