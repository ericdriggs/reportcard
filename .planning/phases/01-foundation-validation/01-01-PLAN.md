---
phase: 01-foundation-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/browse/BrowseJsonControllerTest.java
autonomous: true

must_haves:
  truths:
    - "User can call /v1/api/browse endpoint and receive JSON with companies and orgs"
    - "User can call company-level endpoint and receive JSON with orgs and repos"
    - "User can call org-level endpoint and receive JSON with repos and branches"
    - "User can call repo-level endpoint and receive JSON with branches and jobs"
    - "User can observe valid JSON structure for all hierarchy levels"
  artifacts:
    - path: "reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/browse/BrowseJsonControllerTest.java"
      provides: "Integration tests for BrowseJsonController hierarchy endpoints"
      min_lines: 150
  key_links:
    - from: "BrowseJsonControllerTest"
      to: "BrowseJsonController"
      via: "@Autowired controller field"
      pattern: "controller\\.get"
    - from: "BrowseJsonControllerTest"
      to: "AbstractBrowseServiceTest"
      via: "extends base class"
      pattern: "extends AbstractBrowseServiceTest"
---

<objective>
Create integration test class for BrowseJsonController hierarchy endpoints (company, org, repo, branch levels).

Purpose: Validate existing JSON endpoints serialize correctly without errors. Establish testing patterns for remaining endpoints in subsequent plans.

Output: BrowseJsonControllerTest class with success tests for first 4 hierarchy levels.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-validation/01-CONTEXT.md
@.planning/phases/01-foundation-validation/01-RESEARCH.md

@reportcard-server/src/test/java/io/github/ericdriggs/reportcard/persist/browse/AbstractBrowseServiceTest.java
@reportcard-server/src/test/java/io/github/ericdriggs/reportcard/persist/browse/BrowseServiceTest.java
@reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/BrowseJsonController.java
</context>

<tasks>

<task type="auto">
  <name>Create BrowseJsonControllerTest with hierarchy endpoint tests</name>
  <files>reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/browse/BrowseJsonControllerTest.java</files>
  <action>
Create test class that extends AbstractBrowseServiceTest and autowires BrowseJsonController.

Follow existing BrowseServiceTest patterns but call controller methods instead of service methods.

Implement success tests for these 4 hierarchy endpoints:
1. getCompanyOrgs() - root level, returns Map<CompanyPojo, Set<OrgPojo>>
2. getCompanyOrgsRepos(company) - company level, returns Map<CompanyPojo, Map<OrgPojo, Set<RepoPojo>>>
3. getOrgReposBranches(company, org) - org level, returns Map<OrgPojo, Map<RepoPojo, Set<BranchPojo>>>
4. getRepoBranchesJobs(company, org, repo) - repo level, returns Map<RepoPojo, Map<BranchPojo, Set<JobPojo>>>

For each test:
- Call controller.methodName() with TestData constants (TestData.company, TestData.org, etc.)
- Assert response.getStatusCode() equals HttpStatus.OK
- Assert response.getBody() is not null
- Assert response.getBody() is not empty (size > 0)
- Verify expected test data appears in response (matching BrowseServiceTest pattern)

Use @SpringBootTest with RANDOM_PORT to ensure full Spring context initialization.
Autowire both BrowseService (via super constructor) and BrowseJsonController (in test constructor).

DO NOT test error cases yet - those are in Plan 03.
DO NOT test SHA lookup endpoints - those are in Plan 03.
  </action>
  <verify>
./gradlew test --tests "io.github.ericdriggs.reportcard.controller.browse.BrowseJsonControllerTest"

All 4 tests pass successfully.
  </verify>
  <done>
BrowseJsonControllerTest exists with 4 passing success tests for hierarchy levels company → org → repo → branch.
Each test validates HTTP 200 status, non-null body, non-empty response, and expected test data presence.
  </done>
</task>

</tasks>

<verification>
Run full test suite to ensure no regressions:
```bash
./gradlew test --tests "*BrowseJsonControllerTest"
./gradlew test --tests "*BrowseServiceTest"
```

Expected: All tests pass with no failures.
</verification>

<success_criteria>
1. BrowseJsonControllerTest class exists in controller/browse package
2. Test class extends AbstractBrowseServiceTest
3. Test class autowires BrowseJsonController via constructor
4. Four test methods exist: getCompanyOrgsJsonSuccessTest, getCompanyOrgsReposJsonSuccessTest, getOrgReposBranchesJsonSuccessTest, getRepoBranchesJobsJsonSuccessTest
5. All tests call controller methods (not service methods directly)
6. All tests verify HTTP 200 status code
7. All tests verify response body is non-null and non-empty
8. All tests verify expected TestData constants appear in response
9. Test execution completes successfully with ./gradlew test
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-validation/01-01-SUMMARY.md` following the summary template.
</output>
