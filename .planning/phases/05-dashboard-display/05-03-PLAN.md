---
phase: 05-dashboard-display
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/graph/PipelineDashboardTest.java
autonomous: true

must_haves:
  truths:
    - "Controller test verifies 'Avg Run Duration' column appears in HTML output"
    - "Test verifies duration displays in readable format (hours, minutes, seconds)"
    - "Test verifies jobs without timing data show '-' character"
    - "Test verifies field description is present"
  artifacts:
    - reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/graph/PipelineDashboardTest.java
  key_links: []
---

<objective>
Write automated controller test for pipeline dashboard timing display using Testcontainers and LocalStack.

Purpose: Verify the avgRunDuration column renders correctly in the pipeline dashboard HTML without requiring RDS data.

Output: PipelineDashboardTest.java with tests covering timing display, NULL handling, and field description.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/eric.r.driggs/github/ericdriggs/reportcard/.planning/PROJECT.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard/.planning/phases/05-dashboard-display/05-CONTEXT.md

# Dependencies
@/Users/eric.r.driggs/github/ericdriggs/reportcard/.planning/phases/05-dashboard-display/05-01-PLAN.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard/.planning/phases/05-dashboard-display/05-02-PLAN.md

# Reference files
@/Users/eric.r.driggs/github/ericdriggs/reportcard/reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/JunitControllerTest.java
@/Users/eric.r.driggs/github/ericdriggs/reportcard/reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/graph/GraphUIController.java
@/Users/eric.r.driggs/github/ericdriggs/reportcard/reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/graph/PipelineDashboardHtmlHelper.java
</context>

<tasks>

<task id="1" type="code">
  <description>Create PipelineDashboardTest.java</description>
  <what>
Create a new test class that:
1. Uses @SpringBootTest with Testcontainers (follow JunitControllerTest pattern)
2. Uploads test data via JunitController with Karate JSON that has timing
3. Calls GraphUIController.getJobDashboard() or graphService.getPipelineDashboard()
4. Verifies HTML output contains:
   - "Avg Run Duration" header
   - Formatted duration value (not null, not raw seconds)
   - "-" for records without timing
   - Field description text
  </what>
  <file>reportcard-server/src/test/java/io/github/ericdriggs/reportcard/controller/graph/PipelineDashboardTest.java</file>
  <verification>
- Test class compiles
- Test method covers: timing display, NULL handling, field description
- Uses existing test patterns (StageDetails, TestData, etc.)
  </verification>
</task>

<task id="2" type="code">
  <description>Add test for job WITH timing data</description>
  <what>
Test that uploads JUnit + Karate tar.gz with timing, then verifies:
- Dashboard shows formatted duration (e.g., "5m 30s" not "330")
- Duration appears in correct table column
  </what>
  <verification>
Test method exists and asserts duration format
  </verification>
</task>

<task id="3" type="code">
  <description>Add test for job WITHOUT timing data (NULL handling)</description>
  <what>
Test that uploads JUnit XML only (no Karate), then verifies:
- Dashboard shows "-" for avgRunDuration
- No "null" text appears
  </what>
  <verification>
Test method exists and asserts "-" display
  </verification>
</task>

</tasks>

<verification>
- All tests compile
- Tests follow existing patterns (JunitControllerTest)
- Tests cover: timing with data, timing without data (NULL), field description
</verification>

<success_criteria>
- PipelineDashboardTest.java exists with test methods
- Tests verify "Avg Run Duration" column appears in HTML
- Tests verify duration formatting (human-readable, not raw seconds)
- Tests verify NULL handling (displays "-")
- Tests verify field description present
</success_criteria>

<output>
Create `.planning/phases/05-dashboard-display/05-03-SUMMARY.md` documenting test implementation and any issues.
</output>
