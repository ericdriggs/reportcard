---
phase: 05-foundation-dtos
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsResponse.java
  - reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsReposResponse.java
  - reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/OrgReposBranchesResponse.java
autonomous: true

must_haves:
  truths:
    - "CompanyOrgsResponse serializes company as object with fields (not toString)"
    - "CompanyOrgsReposResponse nests company + orgs + repos in proper structure"
    - "OrgReposBranchesResponse nests org + repos + branches in proper structure"
    - "All DTOs use @JsonInclude(NON_NULL) for clean responses"
  artifacts:
    - path: "reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsResponse.java"
      provides: "Response DTO for /v1/api endpoint"
      contains: "class CompanyOrgsResponse"
    - path: "reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsReposResponse.java"
      provides: "Response DTO for /company/{company} endpoint"
      contains: "class CompanyOrgsReposResponse"
    - path: "reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/OrgReposBranchesResponse.java"
      provides: "Response DTO for /company/{company}/org/{org} endpoint"
      contains: "class OrgReposBranchesResponse"
  key_links:
    - from: "CompanyOrgsResponse"
      to: "CompanyPojo fields"
      via: "field copying in constructor/builder"
      pattern: "companyId.*companyName"
    - from: "OrgEntry inner class"
      to: "OrgPojo fields"
      via: "field copying"
      pattern: "orgId.*orgName.*companyFk"
---

<objective>
Create three Response DTO classes that transform internal Map structures into clean nested JSON.

Purpose: Establish the DTO pattern for browse endpoints. These DTOs convert Map<Pojo, Map<Pojo, Set<Pojo>>> into structured JSON with {"entity": {...}, "children": [...]} format.

Output: Three DTO classes in new response package that Jackson can serialize to clean JSON.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-foundation-dtos/05-CONTEXT.md

Key files to reference:
@reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/BrowseJsonController.java
@reportcard-server/src/generated/java/io/github/ericdriggs/reportcard/gen/db/tables/pojos/CompanyPojo.java
@reportcard-server/src/generated/java/io/github/ericdriggs/reportcard/gen/db/tables/pojos/OrgPojo.java
@reportcard-server/src/generated/java/io/github/ericdriggs/reportcard/gen/db/tables/pojos/RepoPojo.java
@reportcard-server/src/generated/java/io/github/ericdriggs/reportcard/gen/db/tables/pojos/BranchPojo.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CompanyOrgsResponse DTO</name>
  <files>reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsResponse.java</files>
  <action>
Create CompanyOrgsResponse class in new package `io.github.ericdriggs.reportcard.controller.browse.response`.

Structure (from CONTEXT.md decision):
```json
{
  "companies": [
    {
      "company": {"companyId": 3, "companyName": "hulu"},
      "orgs": [
        {"orgId": 5, "orgName": "streaming", "companyFk": 3}
      ]
    }
  ]
}
```

Implementation requirements:
- Use Lombok @Data @Builder @NoArgsConstructor @AllArgsConstructor
- Use @JsonInclude(JsonInclude.Include.NON_NULL) on class
- Create static inner class CompanyEntry with:
  - Company fields copied: companyId (Integer), companyName (String)
  - List<OrgEntry> orgs
- Create static inner class OrgEntry with:
  - Org fields copied: orgId (Integer), orgName (String), companyFk (Integer)
- Main class has List<CompanyEntry> companies field
- Add static factory method: `fromMap(Map<CompanyPojo, Set<OrgPojo>> map)` that transforms the cache Map to this DTO
- Preserve ordering from input Map (iterate in order, add to ArrayList)
  </action>
  <verify>
File compiles: `./gradlew compileJava -x generateJooqSchemaSource 2>&1 | tail -20`
  </verify>
  <done>
CompanyOrgsResponse.java exists with CompanyEntry, OrgEntry inner classes and fromMap factory method
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CompanyOrgsReposResponse DTO</name>
  <files>reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/CompanyOrgsReposResponse.java</files>
  <action>
Create CompanyOrgsReposResponse class for `/company/{company}` endpoint.

Structure (2 levels of children per CONTEXT.md):
```json
{
  "company": {"companyId": 3, "companyName": "hulu"},
  "orgs": [
    {
      "org": {"orgId": 5, "orgName": "streaming", "companyFk": 3},
      "repos": [
        {"repoId": 10, "repoName": "video-service", "orgFk": 5}
      ]
    }
  ]
}
```

Implementation requirements:
- Use Lombok @Data @Builder @NoArgsConstructor @AllArgsConstructor
- Use @JsonInclude(JsonInclude.Include.NON_NULL) on class
- Top level has:
  - CompanyEntry company (reuse pattern from Task 1 - but simpler, just fields)
  - List<OrgReposEntry> orgs
- Create static inner class CompanyEntry with companyId, companyName
- Create static inner class OrgReposEntry with:
  - OrgEntry org (inner class with orgId, orgName, companyFk)
  - List<RepoEntry> repos
- Create static inner class OrgEntry with orgId, orgName, companyFk
- Create static inner class RepoEntry with repoId, repoName, orgFk
- Add static factory method: `fromMap(Map<CompanyPojo, Map<OrgPojo, Set<RepoPojo>>> map)` that transforms to this DTO
- Note: Input map has single company key (filtered by controller path)
  </action>
  <verify>
File compiles: `./gradlew compileJava -x generateJooqSchemaSource 2>&1 | tail -20`
  </verify>
  <done>
CompanyOrgsReposResponse.java exists with nested structure and fromMap factory method
  </done>
</task>

<task type="auto">
  <name>Task 3: Create OrgReposBranchesResponse DTO</name>
  <files>reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/response/OrgReposBranchesResponse.java</files>
  <action>
Create OrgReposBranchesResponse class for `/company/{company}/org/{org}` endpoint.

Structure:
```json
{
  "org": {"orgId": 5, "orgName": "streaming", "companyFk": 3},
  "repos": [
    {
      "repo": {"repoId": 10, "repoName": "video-service", "orgFk": 5},
      "branches": [
        {"branchId": 20, "branchName": "main", "repoFk": 10, "lastRun": "2026-02-05T10:30:00Z"}
      ]
    }
  ]
}
```

Implementation requirements:
- Use Lombok @Data @Builder @NoArgsConstructor @AllArgsConstructor
- Use @JsonInclude(JsonInclude.Include.NON_NULL) on class
- Top level has:
  - OrgEntry org
  - List<RepoBranchesEntry> repos
- Create static inner class OrgEntry with orgId, orgName, companyFk
- Create static inner class RepoBranchesEntry with:
  - RepoEntry repo
  - List<BranchEntry> branches
- Create static inner class RepoEntry with repoId, repoName, orgFk
- Create static inner class BranchEntry with branchId, branchName, repoFk, lastRun (Instant - Jackson handles ISO-8601)
- Add static factory method: `fromMap(Map<OrgPojo, Map<RepoPojo, Set<BranchPojo>>> map)` that transforms to this DTO
- Note: Input map has single org key (filtered by controller path)
  </action>
  <verify>
File compiles: `./gradlew compileJava -x generateJooqSchemaSource 2>&1 | tail -20`
All three DTOs compile together: `./gradlew compileJava -x generateJooqSchemaSource`
  </verify>
  <done>
OrgReposBranchesResponse.java exists with nested structure and fromMap factory method. All three DTO classes compile successfully.
  </done>
</task>

</tasks>

<verification>
1. All three DTO files exist in response package
2. `./gradlew compileJava -x generateJooqSchemaSource` succeeds
3. Each DTO has:
   - Lombok annotations (@Data @Builder etc.)
   - @JsonInclude(NON_NULL)
   - Nested inner classes for entity + children pattern
   - Static fromMap() factory method
</verification>

<success_criteria>
- CompanyOrgsResponse.java created with companies array containing company+orgs structure
- CompanyOrgsReposResponse.java created with company object + orgs array (each with org+repos)
- OrgReposBranchesResponse.java created with org object + repos array (each with repo+branches)
- All files compile without errors
- Factory methods transform Map structures to DTO structures
</success_criteria>

<output>
After completion, create `.planning/phases/05-foundation-dtos/05-01-SUMMARY.md`
</output>
