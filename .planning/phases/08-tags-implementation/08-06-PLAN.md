---
phase: 08-tags-implementation
plan: 06
type: test
wave: 3
depends_on: ["08-04", "08-05"]
files_modified:
  - reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/karate/KarateCucumberConverterEdgeCaseTest.java
  - reportcard-model/src/test/resources/format-samples/cucumber-json/
autonomous: true

must_haves:
  truths:
    - "Edge cases handled: empty features, missing fields, nested structures"
    - "Real Karate JSON samples parsed correctly"
    - "Status determination correct for all step combinations"
    - "Tag extraction works with various formats"
    - "JUnit XML and Cucumber JSON produce equivalent TestResultModel for same test run"
  artifacts:
    - path: "reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/karate/KarateCucumberConverterEdgeCaseTest.java"
      provides: "Comprehensive edge case tests"
      min_lines: 200
    - path: "reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/JunitCucumberEquivalenceTest.java"
      provides: "Cross-format equivalence tests"
      min_lines: 100
    - path: "reportcard-model/src/test/resources/format-samples/cucumber-json/"
      provides: "Sample Cucumber JSON files for testing"
    - path: "reportcard-model/src/test/resources/format-samples/karate-reports/"
      provides: "Real Karate output with matching JUnit XML and Cucumber JSON"
  key_links:
    - from: "KarateCucumberConverterEdgeCaseTest.java"
      to: "KarateCucumberConverter.java"
      via: "tests converter edge cases"
      pattern: "fromCucumberJson|fromFeature|fromScenario"
    - from: "JunitCucumberEquivalenceTest.java"
      to: "JunitConvertersUtil.java"
      via: "parses JUnit XML for comparison"
      pattern: "JunitConvertersUtil"
    - from: "JunitCucumberEquivalenceTest.java"
      to: "KarateCucumberConverter.java"
      via: "parses Cucumber JSON for comparison"
      pattern: "KarateCucumberConverter"
---

<objective>
Create comprehensive test coverage for KarateCucumberConverter to validate edge cases and real-world Karate JSON samples.

Purpose: The mapper handles complex real-world JSON with various edge cases. Thorough testing ensures robustness during phased rollout and catches issues before production.

Output: Edge case tests, sample JSON files, and validation that mapper handles real Karate output correctly.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-tags-investigation/07-01-TAG-MAPPING-SPEC.md
@.planning/phases/08-tags-implementation/08-04-SUMMARY.md

# Converter implementation
@reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/converter/karate/KarateCucumberConverter.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sample Cucumber JSON test files</name>
  <files>reportcard-model/src/test/resources/format-samples/cucumber-json/</files>
  <action>
    Create directory and sample JSON files for testing various scenarios.

    Create files:

    1. `cucumber-json-simple.json` - Basic feature with passing scenarios
    ```json
    [
      {
        "name": "simple-feature.feature",
        "tags": [{"name": "@smoke", "line": 1}],
        "elements": [
          {
            "name": "passing scenario",
            "type": "scenario",
            "tags": [{"name": "@env=prod", "line": 3}],
            "steps": [
              {"name": "Given setup", "result": {"status": "passed", "duration": 1000000}},
              {"name": "When action", "result": {"status": "passed", "duration": 2000000}},
              {"name": "Then verify", "result": {"status": "passed", "duration": 1500000}}
            ]
          }
        ]
      }
    ]
    ```

    2. `cucumber-json-failed.json` - Feature with failed scenario
    ```json
    [
      {
        "name": "failed-feature.feature",
        "elements": [
          {
            "name": "failing scenario",
            "type": "scenario",
            "steps": [
              {"name": "Given setup", "result": {"status": "passed", "duration": 1000000}},
              {"name": "When action", "result": {"status": "failed", "duration": 500000, "error_message": "Expected 200 but got 500"}}
            ]
          }
        ]
      }
    ]
    ```

    3. `cucumber-json-mixed.json` - Multiple features with mixed results
    4. `cucumber-json-empty.json` - Empty array []
    5. `cucumber-json-no-elements.json` - Feature with no scenarios
    6. `cucumber-json-background.json` - Feature with background (should be skipped)
    7. `cucumber-json-scenario-outline.json` - Scenario outline handling
    8. `cucumber-json-tags-complex.json` - Various tag formats (key=value, commas)
  </action>
  <verify>
    Files exist:
    ```bash
    ls reportcard-model/src/test/resources/format-samples/cucumber-json/
    ```
  </verify>
  <done>
    - Sample JSON files created
    - Cover: simple, failed, mixed, empty, edge cases
    - Files valid JSON
  </done>
</task>

<task type="auto">
  <name>Task 2: Create edge case unit tests</name>
  <files>reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/karate/KarateCucumberConverterEdgeCaseTest.java</files>
  <action>
    Create comprehensive edge case tests.

    ```java
    package io.github.ericdriggs.reportcard.model.converter.karate;

    import io.github.ericdriggs.reportcard.model.TestCaseModel;
    import io.github.ericdriggs.reportcard.model.TestStatus;
    import io.github.ericdriggs.reportcard.model.TestSuiteModel;
    import io.github.ericdriggs.reportcard.xml.ResourceReader;
    import org.junit.jupiter.api.Test;
    import org.junit.jupiter.params.ParameterizedTest;
    import org.junit.jupiter.params.provider.ValueSource;

    import java.math.BigDecimal;
    import java.util.List;

    import static org.junit.jupiter.api.Assertions.*;

    /**
     * Edge case tests for KarateCucumberConverter.
     * Validates robustness against various JSON structures.
     */
    public class KarateCucumberConverterEdgeCaseTest {

        // === NULL AND EMPTY HANDLING ===

        @Test
        void fromCucumberJson_nullInput_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(null);
            assertNotNull(result);
            assertTrue(result.isEmpty());
        }

        @Test
        void fromCucumberJson_emptyString_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson("");
            assertTrue(result.isEmpty());
        }

        @Test
        void fromCucumberJson_blankString_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson("   ");
            assertTrue(result.isEmpty());
        }

        @Test
        void fromCucumberJson_emptyArray_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson("[]");
            assertTrue(result.isEmpty());
        }

        @Test
        void fromCucumberJson_notArray_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson("{}");
            assertTrue(result.isEmpty());
        }

        @Test
        void fromCucumberJson_invalidJson_returnsEmptyList() {
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson("not json");
            assertTrue(result.isEmpty());
        }

        // === FEATURE PARSING ===

        @Test
        void feature_missingName_usesEmptyString() {
            String json = "[{\"elements\":[]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(1, result.size());
            assertEquals("", result.get(0).getName());
        }

        @Test
        void feature_missingTags_returnsEmptyTagsList() {
            String json = "[{\"name\":\"test\",\"elements\":[]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertNotNull(result.get(0).getTags());
            assertTrue(result.get(0).getTags().isEmpty());
        }

        @Test
        void feature_missingElements_returnsEmptyTestCases() {
            String json = "[{\"name\":\"test\"}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertNotNull(result.get(0).getTestCases());
            assertTrue(result.get(0).getTestCases().isEmpty());
            assertEquals(0, result.get(0).getTests());
        }

        @Test
        void feature_emptyElements_returnsEmptyTestCases() {
            String json = "[{\"name\":\"test\",\"elements\":[]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertTrue(result.get(0).getTestCases().isEmpty());
        }

        // === SCENARIO TYPE FILTERING ===

        @Test
        void element_typeBackground_isSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[" +
                "{\"name\":\"background\",\"type\":\"background\",\"steps\":[]}," +
                "{\"name\":\"scenario1\",\"type\":\"scenario\",\"steps\":[]}" +
                "]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            // Only scenario should be included, not background
            assertEquals(1, result.get(0).getTestCases().size());
            assertEquals("scenario1", result.get(0).getTestCases().get(0).getName());
        }

        @Test
        void element_typeScenarioOutline_isIncluded() {
            String json = "[{\"name\":\"test\",\"elements\":[" +
                "{\"name\":\"outline\",\"type\":\"scenario_outline\",\"steps\":[]}" +
                "]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(1, result.get(0).getTestCases().size());
        }

        @Test
        void element_unknownType_isSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[" +
                "{\"name\":\"hook\",\"type\":\"hook\",\"steps\":[]}" +
                "]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertTrue(result.get(0).getTestCases().isEmpty());
        }

        // === STATUS DETERMINATION ===

        @Test
        void scenario_allPassed_statusSuccess() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"passed\",\"duration\":1000}}," +
                "{\"result\":{\"status\":\"passed\",\"duration\":1000}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SUCCESS, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_anyFailed_statusFailure() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"passed\",\"duration\":1000}}," +
                "{\"result\":{\"status\":\"failed\",\"duration\":1000,\"error_message\":\"err\"}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.FAILURE, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_skippedAfterFailure_statusFailure() {
            // When a step fails, subsequent steps are often skipped
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"failed\",\"duration\":1000}}," +
                "{\"result\":{\"status\":\"skipped\",\"duration\":0}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.FAILURE, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_allSkipped_statusSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"skipped\",\"duration\":0}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SKIPPED, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_noSteps_statusSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SKIPPED, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_missingSteps_statusSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\"}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SKIPPED, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_undefinedStep_statusSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"undefined\"}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SKIPPED, result.get(0).getTestCases().get(0).getTestStatus());
        }

        @Test
        void scenario_pendingStep_statusSkipped() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"pending\"}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(TestStatus.SKIPPED, result.get(0).getTestCases().get(0).getTestStatus());
        }

        // === TIME CALCULATION ===

        @Test
        void scenario_sumsDurations_inSeconds() {
            // 1,000,000 + 2,000,000 nanoseconds = 3ms = 0.003 seconds
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"passed\",\"duration\":1000000}}," +
                "{\"result\":{\"status\":\"passed\",\"duration\":2000000}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            BigDecimal expected = new BigDecimal("0.003");
            assertEquals(0, expected.compareTo(result.get(0).getTestCases().get(0).getTime()));
        }

        @Test
        void scenario_missingDuration_treatsAsZero() {
            String json = "[{\"name\":\"test\",\"elements\":[{" +
                "\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[" +
                "{\"result\":{\"status\":\"passed\"}}" +
                "]}]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertEquals(0, BigDecimal.ZERO.compareTo(result.get(0).getTestCases().get(0).getTime()));
        }

        // === TAG COLLECTION ===

        @Test
        void collectAllTags_flattensAndDeduplicates() {
            String json = "[{\"name\":\"f1\",\"tags\":[{\"name\":\"@smoke\"}],\"elements\":[" +
                "{\"name\":\"s1\",\"type\":\"scenario\",\"tags\":[{\"name\":\"@smoke\"},{\"name\":\"@env=prod\"}],\"steps\":[]}" +
                "]}]";
            List<TestSuiteModel> suites = KarateCucumberConverter.fromCucumberJson(json);
            List<String> allTags = KarateCucumberConverter.collectAllTags(suites);

            assertEquals(2, allTags.size()); // smoke, env=prod (deduplicated)
            assertTrue(allTags.contains("smoke"));
            assertTrue(allTags.contains("env=prod"));
        }

        // === SUITE AGGREGATES ===

        @Test
        void suite_aggregatesFromTestCases() {
            // 2 scenarios: 1 passed, 1 failed
            String json = "[{\"name\":\"test\",\"elements\":[" +
                "{\"name\":\"s1\",\"type\":\"scenario\",\"steps\":[{\"result\":{\"status\":\"passed\",\"duration\":1000000000}}]}," +
                "{\"name\":\"s2\",\"type\":\"scenario\",\"steps\":[{\"result\":{\"status\":\"failed\",\"duration\":500000000}}]}" +
                "]}]";
            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            TestSuiteModel suite = result.get(0);
            assertEquals(2, suite.getTests());
            assertEquals(1, suite.getFailure());
            assertEquals(0, suite.getError());
            assertEquals(0, suite.getSkipped());
            assertFalse(suite.getIsSuccess());
            // Time: 1.0 + 0.5 = 1.5 seconds
            assertEquals(0, new BigDecimal("1.500").compareTo(suite.getTime()));
        }

        // === RESOURCE FILE TESTS ===

        @Test
        void parseSimpleJson_fromResourceFile() {
            String json = ResourceReader.resourceAsString(
                "format-samples/cucumber-json/cucumber-json-simple.json");

            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            assertFalse(result.isEmpty());
            // Add specific assertions based on file content
        }

        @ParameterizedTest
        @ValueSource(strings = {
            "format-samples/cucumber-json/cucumber-json-simple.json",
            "format-samples/cucumber-json/cucumber-json-failed.json",
            "format-samples/cucumber-json/cucumber-json-mixed.json"
        })
        void parseResourceFile_doesNotThrow(String resourcePath) {
            String json = ResourceReader.resourceAsString(resourcePath);
            assertDoesNotThrow(() -> KarateCucumberConverter.fromCucumberJson(json));
        }
    }
    ```
  </action>
  <verify>
    Run tests:
    ```bash
    ./gradlew :reportcard-model:test --tests "*.KarateCucumberConverterEdgeCaseTest" --info
    ```
  </verify>
  <done>
    - Edge case tests cover null, empty, missing fields
    - Status determination tested for all combinations
    - Time calculation tested
    - Tag collection tested
    - Resource file tests included
  </done>
</task>

<task type="auto">
  <name>Task 3: Test with real Karate output (if available)</name>
  <files>reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/karate/KarateRealWorldTest.java</files>
  <action>
    If user has real Karate JSON output, create tests using that data.

    This is a placeholder for real-world validation. The user should:
    1. Copy actual karate-json.txt files from CI runs to test resources
    2. Add specific assertions for expected feature/scenario counts
    3. Validate tag extraction from real data

    ```java
    package io.github.ericdriggs.reportcard.model.converter.karate;

    import io.github.ericdriggs.reportcard.model.TestSuiteModel;
    import io.github.ericdriggs.reportcard.xml.ResourceReader;
    import org.junit.jupiter.api.Disabled;
    import org.junit.jupiter.api.Test;

    import java.util.List;

    import static org.junit.jupiter.api.Assertions.*;

    /**
     * Tests using real Karate JSON output.
     * Enable when real sample files are available.
     */
    public class KarateRealWorldTest {

        @Test
        @Disabled("Enable when real Karate JSON is available at this path")
        void parseRealKarateOutput() {
            String json = ResourceReader.resourceAsString(
                "format-samples/cucumber-json/real-karate-output.json");

            List<TestSuiteModel> result = KarateCucumberConverter.fromCucumberJson(json);

            // Add assertions based on known content of real file
            assertFalse(result.isEmpty(), "Should parse at least one feature");

            // Example assertions (adjust based on actual data):
            // assertEquals(5, result.size(), "Should have 5 features");
            // assertTrue(result.get(0).getTags().contains("smoke"));
        }
    }
    ```
  </action>
  <verify>
    Test compiles (may be disabled):
    ```bash
    ./gradlew :reportcard-model:compileTestJava
    ```
  </verify>
  <done>
    - Real-world test structure created
    - Placeholder for actual Karate JSON
    - Instructions for adding real data
  </done>
</task>

<task type="auto">
  <name>Task 4: Copy real Karate sample data to test resources</name>
  <files>reportcard-model/src/test/resources/format-samples/karate-reports/</files>
  <action>
    Copy real Karate output from cucumber-json/karate-reports/ to test resources.
    These files contain matching JUnit XML and Cucumber JSON for the same test runs.

    ```bash
    mkdir -p reportcard-model/src/test/resources/format-samples/karate-reports/

    # Copy the delorean test pair (1 scenario)
    cp cucumber-json/karate-reports/delorean-create-dss-test.xml \
       reportcard-model/src/test/resources/format-samples/karate-reports/
    cp cucumber-json/karate-reports/delorean-create-dss-test.json \
       reportcard-model/src/test/resources/format-samples/karate-reports/

    # Copy the cache-and-load test pair (2 scenarios)
    cp cucumber-json/karate-reports/cache-and-load-accounts-test.xml \
       reportcard-model/src/test/resources/format-samples/karate-reports/
    cp cucumber-json/karate-reports/cache-and-load-accounts-test.json \
       reportcard-model/src/test/resources/format-samples/karate-reports/
    ```

    File pairs for equivalence testing:
    - delorean-create-dss-test.xml + .json (1 test, 19.3s)
    - cache-and-load-accounts-test.xml + .json (2 tests, 0.004s)
  </action>
  <verify>
    Files copied:
    ```bash
    ls -la reportcard-model/src/test/resources/format-samples/karate-reports/
    ```
  </verify>
  <done>
    - Real Karate output copied to test resources
    - Both .xml and .json files for same test runs
    - Two test pairs available for equivalence testing
  </done>
</task>

<task type="auto">
  <name>Task 5: Create cross-format equivalence tests</name>
  <files>reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/converter/JunitCucumberEquivalenceTest.java</files>
  <action>
    Create tests that parse both JUnit XML and Cucumber JSON for the same test run
    and verify they produce equivalent TestResultModel outputs.

    ```java
    package io.github.ericdriggs.reportcard.model.converter;

    import io.github.ericdriggs.reportcard.model.TestCaseModel;
    import io.github.ericdriggs.reportcard.model.TestResultModel;
    import io.github.ericdriggs.reportcard.model.TestSuiteModel;
    import io.github.ericdriggs.reportcard.model.converter.junit.JunitConvertersUtil;
    import io.github.ericdriggs.reportcard.model.converter.karate.KarateCucumberConverter;
    import io.github.ericdriggs.reportcard.xml.ResourceReader;
    import org.junit.jupiter.api.Test;
    import org.junit.jupiter.params.ParameterizedTest;
    import org.junit.jupiter.params.provider.CsvSource;

    import java.math.BigDecimal;
    import java.util.List;

    import static org.junit.jupiter.api.Assertions.*;

    /**
     * Cross-format equivalence tests.
     * Verifies that parsing JUnit XML and Cucumber JSON from the same test run
     * produces equivalent TestResultModel outputs.
     *
     * This catches drift between parsers and ensures consistency when
     * Karate produces both JUnit XML and its own JSON format.
     */
    public class JunitCucumberEquivalenceTest {

        private static final String KARATE_REPORTS_PATH = "format-samples/karate-reports/";
        private static final BigDecimal TIME_TOLERANCE = new BigDecimal("0.1"); // 100ms tolerance

        /**
         * Parse JUnit XML and Cucumber JSON for the same test run,
         * verify they produce equivalent results.
         */
        @ParameterizedTest(name = "{0}: {1} tests expected")
        @CsvSource({
            "delorean-create-dss-test, 1",
            "cache-and-load-accounts-test, 2"
        })
        void equivalence_junitAndCucumber_sameTestRun(String baseName, int expectedTests) {
            // Parse JUnit XML
            String junitXml = ResourceReader.resourceAsString(
                KARATE_REPORTS_PATH + baseName + ".xml");
            TestResultModel junitResult = JunitConvertersUtil.modelFromXml(junitXml);

            // Parse Cucumber JSON
            String cucumberJson = ResourceReader.resourceAsString(
                KARATE_REPORTS_PATH + baseName + ".json");
            List<TestSuiteModel> cucumberSuites = KarateCucumberConverter.fromCucumberJson(cucumberJson);
            TestResultModel cucumberResult = new TestResultModel(cucumberSuites);

            // === EQUIVALENCE CHECKS ===

            // Test count must match
            assertEquals(junitResult.getTests(), cucumberResult.getTests(),
                "Test count mismatch between JUnit and Cucumber");
            assertEquals(expectedTests, junitResult.getTests(),
                "Test count doesn't match expected");

            // Failure count must match
            assertEquals(junitResult.getFailures(), cucumberResult.getFailures(),
                "Failure count mismatch between JUnit and Cucumber");

            // Skip count must match
            assertEquals(junitResult.getSkipped(), cucumberResult.getSkipped(),
                "Skip count mismatch between JUnit and Cucumber");

            // Error count must match
            assertEquals(junitResult.getErrors(), cucumberResult.getErrors(),
                "Error count mismatch between JUnit and Cucumber");

            // Suite count must match
            assertEquals(junitResult.getTestSuites().size(), cucumberResult.getTestSuites().size(),
                "Suite count mismatch between JUnit and Cucumber");

            // Suite names must match (feature name = testsuite name)
            for (int i = 0; i < junitResult.getTestSuites().size(); i++) {
                TestSuiteModel junitSuite = junitResult.getTestSuites().get(i);
                TestSuiteModel cucumberSuite = cucumberResult.getTestSuites().get(i);

                assertEquals(junitSuite.getName(), cucumberSuite.getName(),
                    "Suite name mismatch at index " + i);
                assertEquals(junitSuite.getTests(), cucumberSuite.getTests(),
                    "Suite test count mismatch for " + junitSuite.getName());
            }
        }

        /**
         * Verify test case names match between formats.
         * JUnit uses testcase/@name, Cucumber uses element/name.
         */
        @Test
        void equivalence_testCaseNames_match() {
            String baseName = "delorean-create-dss-test";

            // Parse both formats
            String junitXml = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".xml");
            TestResultModel junitResult = JunitConvertersUtil.modelFromXml(junitXml);

            String cucumberJson = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".json");
            List<TestSuiteModel> cucumberSuites = KarateCucumberConverter.fromCucumberJson(cucumberJson);

            // Get test case names from both
            List<String> junitNames = junitResult.getTestSuites().stream()
                .flatMap(s -> s.getTestCases().stream())
                .map(TestCaseModel::getName)
                .toList();

            List<String> cucumberNames = cucumberSuites.stream()
                .flatMap(s -> s.getTestCases().stream())
                .map(TestCaseModel::getName)
                .toList();

            assertEquals(junitNames.size(), cucumberNames.size(),
                "Test case count mismatch");

            // Names should match (order may differ due to scenario ordering)
            for (String junitName : junitNames) {
                assertTrue(cucumberNames.contains(junitName),
                    "Test case '" + junitName + "' from JUnit not found in Cucumber");
            }
        }

        /**
         * Verify total time is approximately equal between formats.
         * Some variance expected due to:
         * - JUnit time includes setup/teardown
         * - Cucumber sums step durations (nanoseconds → seconds rounding)
         */
        @ParameterizedTest(name = "{0}")
        @CsvSource({
            "delorean-create-dss-test",
            "cache-and-load-accounts-test"
        })
        void equivalence_totalTime_approximatelyEqual(String baseName) {
            // Parse both formats
            String junitXml = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".xml");
            TestResultModel junitResult = JunitConvertersUtil.modelFromXml(junitXml);

            String cucumberJson = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".json");
            List<TestSuiteModel> cucumberSuites = KarateCucumberConverter.fromCucumberJson(cucumberJson);
            TestResultModel cucumberResult = new TestResultModel(cucumberSuites);

            BigDecimal junitTime = junitResult.getTime();
            BigDecimal cucumberTime = cucumberResult.getTime();

            // Times should be within tolerance
            // Note: May need to adjust tolerance based on actual variance observed
            BigDecimal diff = junitTime.subtract(cucumberTime).abs();

            // For very short tests, use percentage tolerance instead
            BigDecimal maxTime = junitTime.max(cucumberTime);
            if (maxTime.compareTo(BigDecimal.ONE) < 0) {
                // For sub-second tests, allow 50% variance
                BigDecimal percentTolerance = maxTime.multiply(new BigDecimal("0.5"));
                assertTrue(diff.compareTo(percentTolerance) <= 0,
                    String.format("Time diff %s exceeds 50%% tolerance for %s (JUnit: %s, Cucumber: %s)",
                        diff, baseName, junitTime, cucumberTime));
            } else {
                // For longer tests, allow fixed tolerance
                assertTrue(diff.compareTo(TIME_TOLERANCE) <= 0,
                    String.format("Time diff %s exceeds tolerance %s for %s (JUnit: %s, Cucumber: %s)",
                        diff, TIME_TOLERANCE, baseName, junitTime, cucumberTime));
            }
        }

        /**
         * Verify isSuccess flag matches between formats.
         */
        @ParameterizedTest(name = "{0}")
        @CsvSource({
            "delorean-create-dss-test, true",
            "cache-and-load-accounts-test, true"
        })
        void equivalence_isSuccess_matches(String baseName, boolean expectedSuccess) {
            // Parse both formats
            String junitXml = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".xml");
            TestResultModel junitResult = JunitConvertersUtil.modelFromXml(junitXml);

            String cucumberJson = ResourceReader.resourceAsString(KARATE_REPORTS_PATH + baseName + ".json");
            List<TestSuiteModel> cucumberSuites = KarateCucumberConverter.fromCucumberJson(cucumberJson);
            TestResultModel cucumberResult = new TestResultModel(cucumberSuites);

            assertEquals(junitResult.getIsSuccess(), cucumberResult.getIsSuccess(),
                "isSuccess mismatch between JUnit and Cucumber");
            assertEquals(expectedSuccess, junitResult.getIsSuccess(),
                "isSuccess doesn't match expected");
        }
    }
    ```
  </action>
  <verify>
    Run equivalence tests:
    ```bash
    ./gradlew :reportcard-model:test --tests "*.JunitCucumberEquivalenceTest" --info
    ```
  </verify>
  <done>
    - Cross-format equivalence tests created
    - Tests verify: test count, failure count, suite names, test case names
    - Time comparison with tolerance for rounding differences
    - isSuccess flag comparison
    - Uses real Karate output data
  </done>
</task>

</tasks>

<verification>
Full test run:
```bash
./gradlew :reportcard-model:test --tests "io.github.ericdriggs.reportcard.model.converter.karate.*" --info
```

All tests should pass.
</verification>

<success_criteria>
1. Sample Cucumber JSON files created in test resources
2. Edge case tests cover all null/empty/missing scenarios
3. Status determination tested for all step status combinations
4. Time calculation verified (nanoseconds → seconds)
5. Tag collection tested (flattening, deduplication)
6. Suite aggregation tested
7. Real Karate sample data copied to test resources
8. Cross-format equivalence tests verify JUnit and Cucumber produce same results
9. Equivalence tests cover: test count, failure count, suite names, test case names, time (within tolerance), isSuccess
10. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-tags-implementation/08-06-SUMMARY.md`
</output>
