---
phase: 08-tags-implementation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestSuite.java
  - reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestCase.java
  - reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestSuiteModel.java
  - reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestCaseModel.java
autonomous: true

must_haves:
  truths:
    - "TestSuiteModel has tags field for feature-level tags"
    - "TestCaseModel has tags field for scenario-level tags"
    - "Tags serialize to JSON as string arrays"
    - "Tags default to empty list (not null)"
  artifacts:
    - path: "reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestSuite.java"
      provides: "Base DTO with tags field"
      contains: "List<String> tags"
    - path: "reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestCase.java"
      provides: "Base DTO with tags field"
      contains: "List<String> tags"
    - path: "reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestSuiteModel.java"
      provides: "Model with tags getter/setter"
      contains: "getTags"
    - path: "reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestCaseModel.java"
      provides: "Model with tags getter/setter"
      contains: "getTags"
  key_links:
    - from: "TestSuiteModel.java"
      to: "TestSuite.java"
      via: "extends relationship"
      pattern: "extends.*TestSuite"
    - from: "TestCaseModel.java"
      to: "TestCase.java"
      via: "extends relationship"
      pattern: "extends.*TestCase"
---

<objective>
Add tags field to TestSuiteModel and TestCaseModel for storing feature-level and scenario-level tags.

Purpose: Tags extracted from Karate JSON need to be stored in the model layer for JSON serialization into test_suites_json column.

Output: Updated DTO and Model classes with tags field supporting JSON serialization.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-tags-investigation/07-01-TAG-MAPPING-SPEC.md

# Existing model structure
@reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestSuite.java
@reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestSuiteModel.java
@reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestCaseModel.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TestCase DTO and add tags to TestSuite DTO</name>
  <files>
    reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestCase.java
    reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/TestSuite.java
  </files>
  <action>
    1. Create TestCase.java DTO in reportcard-model/src/main/java/io/github/ericdriggs/reportcard/dto/ package:
       - Follow TestSuite.java pattern (Serializable, @SuperBuilder, @Data)
       - Add fields: testCaseId (Long), testSuiteFk (Long), name (String), className (String), time (BigDecimal), testStatusFk (Byte)
       - Add tags field: private List<String> tags = new ArrayList<>();

    2. Update TestSuite.java to add tags field:
       - Add field: private List<String> tags = new ArrayList<>();
       - Place after existing fields (before closing brace)

    Note: DTOs use @Data from Lombok which generates getters/setters. The Model classes extend these DTOs.
  </action>
  <verify>
    Compile check:
    ```bash
    ./gradlew :reportcard-model:compileJava
    ```
  </verify>
  <done>
    - TestCase.java exists with tags field
    - TestSuite.java has tags field
    - Both compile successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Update TestCaseModel to extend TestCase DTO</name>
  <files>reportcard-model/src/main/java/io/github/ericdriggs/reportcard/model/TestCaseModel.java</files>
  <action>
    Update TestCaseModel.java:

    1. Change class declaration to extend the new TestCase DTO:
       - FROM: public class TestCaseModel extends io.github.ericdriggs.reportcard.dto.TestCase
       - TO: (same, but now TestCase exists with tags field)

    2. The @SuperBuilder pattern already handles field inheritance. Verify the tags field is accessible via getter/setter from parent class.

    3. If TestCaseModel doesn't currently extend TestCase DTO, add the extends clause and ensure @SuperBuilder annotation is present.

    Note: TestCaseModel already uses @SuperBuilder(toBuilder = true) and @Data, so tags getter/setter will be inherited from DTO.
  </action>
  <verify>
    Compile check:
    ```bash
    ./gradlew :reportcard-model:compileJava
    ```
  </verify>
  <done>
    - TestCaseModel extends TestCase DTO
    - getTags() and setTags() accessible on TestCaseModel
    - Compiles successfully
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify JSON serialization of tags</name>
  <files>reportcard-model/src/test/java/io/github/ericdriggs/reportcard/model/TestSuiteModelTagsTest.java</files>
  <action>
    Create a simple unit test to verify tags serialize correctly to JSON:

    ```java
    package io.github.ericdriggs.reportcard.model;

    import com.fasterxml.jackson.databind.ObjectMapper;
    import io.github.ericdriggs.reportcard.mappers.SharedObjectMappers;
    import org.junit.jupiter.api.Test;

    import java.util.Arrays;
    import java.util.List;

    import static org.junit.jupiter.api.Assertions.*;

    public class TestSuiteModelTagsTest {

        private final ObjectMapper mapper = SharedObjectMappers.ignoreUnknownObjectMapper;

        @Test
        void testSuiteModel_tagsSerializeToJson() throws Exception {
            TestSuiteModel suite = TestSuiteModel.builder()
                .name("test-feature.feature")
                .tags(Arrays.asList("smoke", "env=staging"))
                .build();

            String json = mapper.writeValueAsString(suite);

            assertTrue(json.contains("\"tags\""));
            assertTrue(json.contains("\"smoke\""));
            assertTrue(json.contains("\"env=staging\""));
        }

        @Test
        void testCaseModel_tagsSerializeToJson() throws Exception {
            TestCaseModel testCase = TestCaseModel.builder()
                .name("test scenario")
                .tags(Arrays.asList("regression", "browser=chrome"))
                .build();

            String json = mapper.writeValueAsString(testCase);

            assertTrue(json.contains("\"tags\""));
            assertTrue(json.contains("\"regression\""));
            assertTrue(json.contains("\"browser=chrome\""));
        }

        @Test
        void testSuiteModel_fromJson_deserializesTags() throws Exception {
            String json = "{\"name\":\"test.feature\",\"tags\":[\"smoke\",\"env=prod\"]}";

            TestSuiteModel suite = mapper.readValue(json, TestSuiteModel.class);

            assertNotNull(suite.getTags());
            assertEquals(2, suite.getTags().size());
            assertTrue(suite.getTags().contains("smoke"));
            assertTrue(suite.getTags().contains("env=prod"));
        }
    }
    ```
  </action>
  <verify>
    Run tests:
    ```bash
    ./gradlew :reportcard-model:test --tests "*.TestSuiteModelTagsTest" --info
    ```
  </verify>
  <done>
    - All serialization tests pass
    - Tags roundtrip through JSON correctly
  </done>
</task>

</tasks>

<verification>
Full module build:
```bash
./gradlew :reportcard-model:build
```

Should complete without errors, confirming:
- DTOs compile with tags field
- Models inherit tags field correctly
- JSON serialization works
</verification>

<success_criteria>
1. TestCase.java DTO exists with tags field
2. TestSuite.java DTO has tags field
3. TestSuiteModel.getTags() returns List<String>
4. TestCaseModel.getTags() returns List<String>
5. Tags serialize/deserialize to JSON correctly
6. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-tags-implementation/08-02-SUMMARY.md`
</output>
