---
phase: 02-add-company-level-dashboard
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/graph/GraphUIController.java
  - reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/BrowseHtmlHelper.java
autonomous: false

must_haves:
  truths:
    - User can access company-level jobs dashboard at /company/{company}/jobs
    - Company dashboard displays jobs organized by org
    - User can filter company dashboard using ?days=N query parameter
    - User can navigate to company jobs from company browse page
  artifacts:
    - path: reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/graph/GraphUIController.java
      provides: Company-level jobs endpoint
      contains: "company/{company}/jobs"
      min_lines: 250
    - path: reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/BrowseHtmlHelper.java
      provides: Company jobs navigation link
      contains: "Jobs ‚è≤"
      min_lines: 75
  key_links:
    - from: GraphUIController.getCompanyJobDashboard
      to: graphService.getPipelineDashboard
      via: controller endpoint calls service with null org
      pattern: "JobDashboardRequest\\.builder.*\\.company.*\\.build"
    - from: BrowseHtmlHelper.getCompanyLinks
      to: /company/{company}/jobs
      via: HTML link navigation
      pattern: "/company/.*?/jobs"
---

<objective>
Company-level jobs dashboard endpoint and navigation to enable users to view all jobs across orgs within a company.

Purpose: Complete Phase 2 by adding the user-facing endpoint and navigation that consumes the backend support from Plan 01.

Output: Working company-level jobs dashboard accessible via URL with navigation from company browse page.
</objective>

<execution_context>
@/Users/eric.r.driggs/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eric.r.driggs/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/PROJECT.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/ROADMAP.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/STATE.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/phases/02-add-company-level-dashboard/02-RESEARCH.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/phases/02-add-company-level-dashboard/02-01-SUMMARY.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/.planning/phases/01-rename-org-level-dashboard/01-01-SUMMARY.md
@/Users/eric.r.driggs/github/ericdriggs/reportcard-company-job-dashboard/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add company-level jobs endpoint</name>
  <files>reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/graph/GraphUIController.java</files>
  <action>
Add new company-level endpoint after the existing org-level jobs endpoint (after line 230):

```java
@GetMapping(path = "company/{company}/jobs", produces = "text/html;charset=UTF-8")
public ResponseEntity<String> getCompanyJobDashboard(
        @PathVariable String company,
        @RequestParam(required = false) List<String> jobInfo,
        @RequestParam(required = false, defaultValue = "90") Integer days
) {
    Map<String, String> jobInfoMap = JobInfoParser.parseJobInfoParams(jobInfo);

    JobDashboardRequest request = JobDashboardRequest.builder()
            .company(company)
            // org is null for company-level view
            .jobInfos(jobInfoMap)
            .days(days)
            .build();
    List<JobDashboardMetrics> metrics = graphService.getPipelineDashboard(request);
    return new ResponseEntity<>(
        PipelineDashboardHtmlHelper.renderPipelineDashboardMetrics(metrics, request),
        HttpStatus.OK
    );
}
```

**Why this pattern:**
- Mirrors existing org-level endpoint structure (lines 213-230 per 02-RESEARCH.md line 217)
- Omits org path variable - URL is `/company/{company}/jobs` (no org segment)
- Uses same JobInfoParser for query parameter parsing (existing pattern)
- Calls same service method as org-level (getPipelineDashboard)
- Calls same HTML helper (renderPipelineDashboardMetrics)
- org field in request is null, triggering conditional logic from Plan 01

**Query parameters supported:**
- `?days=N` - filter to runs within last N days (default 90)
- `?jobInfo=key1:value1&jobInfo=key2:value2` - filter by job metadata

**What to avoid:**
- Do NOT modify existing getJobDashboard() method (line 213) - that's the org-level endpoint
- Do NOT create new service methods - reuse existing getPipelineDashboard()
- Do NOT create new HTML helpers - reuse existing renderPipelineDashboardMetrics()
  </action>
  <verify>
Run: `./gradlew build`

Verify no compilation errors. Check GraphUIController.java contains new method `getCompanyJobDashboard` with mapping `company/{company}/jobs` (no org in path).
  </verify>
  <done>
- GraphUIController compiles without errors
- New getCompanyJobDashboard() method exists with @GetMapping("company/{company}/jobs")
- Method accepts company, jobInfo, days parameters (no org parameter)
- Method builds JobDashboardRequest with null org
- Method calls existing graphService.getPipelineDashboard(request)
- Method returns HTML via PipelineDashboardHtmlHelper.renderPipelineDashboardMetrics()
  </done>
</task>

<task type="auto">
  <name>Task 2: Add company jobs navigation link</name>
  <files>reportcard-server/src/main/java/io/github/ericdriggs/reportcard/controller/browse/BrowseHtmlHelper.java</files>
  <action>
Update `getCompanyLinks()` method (line 58) to add company jobs link:

**Replace the method body (lines 60-69) with:**
```java
return
        """
        <fieldset>
        <legend>{companyName} links</legend>
            {jobsLink}<br>
            {metricsLink}
        </fieldset>
        """
                .replace("{companyName}", company)
                .replace("{jobsLink}", "<a href='/company/" + company + "/jobs?days=90' style='text-decoration: none;'>" + company + " Jobs ‚è≤</a>")
                .replace("{metricsLink}", getLink(company + " Metrics üî¢", "/metrics/company/" + company));
```

**Why this change:**
- Adds "Company Jobs ‚è≤" link pointing to `/company/{company}/jobs?days=90`
- Uses clock emoji ‚è≤ to match existing org-level "Jobs ‚è≤" pattern (from 01-01-SUMMARY.md line 62)
- Defaults to 90 days (same as endpoint default)
- Placed before metrics link (jobs are more commonly accessed than metrics)
- Uses inline style for consistency with existing getLink() helper pattern

**What to avoid:**
- Do NOT modify other methods in BrowseHtmlHelper - only getCompanyLinks()
- Do NOT change the metrics link - preserve existing functionality
  </action>
  <verify>
Run: `./gradlew build`

Verify no compilation errors. Check BrowseHtmlHelper.java getCompanyLinks() method contains `{jobsLink}` placeholder and replacement with "/company/" + company + "/jobs?days=90".
  </verify>
  <done>
- BrowseHtmlHelper compiles without errors
- getCompanyLinks() method returns HTML with jobs link
- Jobs link points to /company/{company}/jobs?days=90
- Jobs link uses "Jobs ‚è≤" text with clock emoji
- Metrics link preserved (still present below jobs link)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Company-level jobs dashboard with navigation link. This completes Phase 2 by adding:
1. Backend support for null org queries (Plan 01)
2. Company-level endpoint at /company/{company}/jobs (Plan 02 Task 1)
3. Navigation link from company browse page (Plan 02 Task 2)
  </what-built>
  <how-to-verify>
**Step 1: Start the application**
```bash
./gradlew bootRun
```
Wait for "Started ReportcardApplication" message.

**Step 2: Test company-level jobs dashboard**

Visit company browse page (replace {company} with actual company in your database):
```
http://localhost:8080/company/{company}
```

Expected: Page displays with "Company Jobs ‚è≤" link in company links fieldset.

Click "Company Jobs ‚è≤" link.

Expected:
- URL is `http://localhost:8080/company/{company}/jobs?days=90`
- Page title shows company name only (not "company/null")
- Table displays with Company, Org, Repo, Branch, Job columns
- Jobs from multiple orgs appear (if company has multiple orgs)
- Org column shows different org names (demonstrates aggregation across orgs)
- Last 90 days of job runs displayed

**Step 3: Test query parameters**

Try different days filter:
```
http://localhost:8080/company/{company}/jobs?days=30
```
Expected: Shows only last 30 days of runs.

**Step 4: Verify org-level still works (regression test)**

Visit org-level jobs dashboard:
```
http://localhost:8080/company/{company}/org/{org}/jobs?days=90
```

Expected:
- Page title shows "company/org" (includes org)
- Table displays jobs only for specified org
- No behavioral change from Phase 1

**Step 5: Visual comparison**

Compare company-level and org-level dashboards:
- Company-level shows multiple orgs in Org column (if applicable)
- Org-level shows single org repeatedly in Org column
- Both use identical table layout and styling
  </how-to-verify>
  <resume-signal>
Type "approved" if all verification steps pass and functionality works as expected.

If issues found, describe the problem (include URL tested, expected vs actual behavior, any error messages).
  </resume-signal>
</task>

</tasks>

<verification>
After task completion:

1. **Company-level endpoint accessible:** GET `/company/{company}/jobs` returns HTML dashboard
2. **Query parameters work:** `?days=N` and `?jobInfo=...` parameters filter results
3. **Navigation link present:** Company browse page includes "Company Jobs ‚è≤" link
4. **Org grouping visible:** Company dashboard table shows org column with multiple org names (if applicable)
5. **No regressions:** Org-level endpoint `/company/{company}/org/{org}/jobs` still works identically
6. **Requirements met:** URL-03 (company endpoint) and URL-04 (days parameter) satisfied
</verification>

<success_criteria>
Phase 2 complete when:
- User can access `/company/{company}/jobs` endpoint
- Company dashboard displays jobs from all orgs within company
- Jobs are organized by org (visible in org column)
- User can filter using `?days=N` query parameter
- Navigation link exists on company browse page
- Org-level dashboard unchanged (regression-free)
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/02-add-company-level-dashboard/02-02-SUMMARY.md`
</output>
